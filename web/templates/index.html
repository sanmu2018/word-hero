<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Word Hero - 雅思词汇学习</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <h1 class="title">
                    <i class="fas fa-book-open"></i>
                    Word Hero
                </h1>
                <p class="subtitle">雅思词汇学习系统</p>
                <div class="header-actions">
                    <button id="statisticsBtn" class="stats-btn" onclick="showStatisticsModal()" title="查看学习统计">
                        <i class="fas fa-chart-bar"></i>
                    </button>
                    <!-- Authentication Controls -->
                    <div id="authControls" class="auth-controls">
                        <div id="loginSection" class="auth-section">
                            <button id="loginBtn" class="auth-btn login-btn" onclick="showLoginModal()">
                                <i class="fas fa-sign-in-alt"></i>
                                登录
                            </button>
                            <button id="registerBtn" class="auth-btn register-btn" onclick="showRegisterModal()">
                                <i class="fas fa-user-plus"></i>
                                注册
                            </button>
                        </div>
                        <div id="userSection" class="auth-section" style="display: none;">
                            <span id="userDisplay" class="user-display"></span>
                            <button id="profileBtn" class="auth-btn profile-btn" onclick="showProfileModal()" title="个人资料">
                                <i class="fas fa-user"></i>
                            </button>
                            <button id="logoutBtn" class="auth-btn logout-btn" onclick="logout()" title="退出登录">
                                <i class="fas fa-sign-out-alt"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Action Controls -->
        <div class="action-controls">
            <div class="control-group">
                <!-- Search Controls -->
                <div class="search-controls">
                    <button id="searchBtn" class="action-btn search-btn" onclick="showSearchModal()">
                        <i class="fas fa-search"></i>
                        搜索
                    </button>
                </div>
                
                <!-- Toggle Controls -->
                <div class="toggle-controls">
                    <button id="toggleWords" class="action-btn toggle-btn" title="隐藏/显示英文单词 (Ctrl+W)">
                        <i class="fas fa-eye"></i>
                        单词
                    </button>
                    <button id="toggleTranslations" class="action-btn toggle-btn" title="隐藏/显示中文翻译 (Ctrl+T)">
                        <i class="fas fa-eye"></i>
                        翻译
                    </button>
                    <button id="shuffleBtn" class="action-btn shuffle-btn" title="打乱顺序 (Ctrl+R)">
                        <i class="fas fa-random"></i>
                        打乱
                    </button>
                    <button id="restoreBtn" class="action-btn restore-btn" title="恢复原始顺序">
                        <i class="fas fa-undo-alt"></i>
                        恢复
                    </button>
                    <button id="resetKnownWords" class="action-btn reset-btn" title="重置所有标记和顺序 (Ctrl+Shift+R)">
                        <i class="fas fa-undo"></i>
                        重置
                    </button>
                </div>
                
                <!-- Accent Selection -->
                <div class="accent-controls">
                    <div class="accent-options">
                        <button id="accentUS" class="accent-btn" data-accent="us" title="美式英语">
                            🇺🇸
                        </button>
                        <button id="accentUK" class="accent-btn active" data-accent="uk" title="英式英语">
                            🇬🇧
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Vocabulary Cards -->
        <div class="vocabulary-container">
            <div class="vocabulary-grid" id="vocabularyGrid">
                <!-- Cards will be dynamically loaded via API -->
                <div class="loading-placeholder">
                    <i class="fas fa-spinner fa-spin"></i>
                    <span>正在加载词汇...</span>
                </div>
            </div>
        </div>

  
        <!-- Navigation -->
        <div class="navigation">
            <div class="nav-controls">
                <div class="nav-left">
                    <div class="page-size-control">
                        <label for="pageSizeSelect">每页显示：</label>
                        <select id="pageSizeSelect">
                            <option value="12">12 个单词</option>
                            <option value="24" selected>24 个单词</option>
                            <option value="36">36 个单词</option>
                            <option value="48">48 个单词</option>
                            <option value="60">60 个单词</option>
                        </select>
                    </div>
                    <div class="total-words">
                        <i class="fas fa-list"></i>
                        <span>{{.TotalWords}}</span> 个单词
                    </div>
                </div>
                <div class="nav-buttons">
                    <button id="firstBtn" {{if eq .CurrentPage 1}}disabled{{end}}>
                        <i class="fas fa-angle-double-left"></i>
                        首页
                    </button>
                    <button id="prevBtn" {{if eq .CurrentPage 1}}disabled{{end}}>
                        <i class="fas fa-angle-left"></i>
                        上一页
                    </button>
                    <div class="page-jump">
                        <input type="number" id="pageInput" min="1" max="{{.TotalPages}}" value="{{.CurrentPage}}">
                        <button id="goBtn">
                            <i class="fas fa-arrow-right"></i>
                            跳转
                        </button>
                    </div>
                    <button id="nextBtn" {{if eq .CurrentPage .TotalPages}}disabled{{end}}>
                        下一页
                        <i class="fas fa-angle-right"></i>
                    </button>
                    <button id="lastBtn" {{if eq .CurrentPage .TotalPages}}disabled{{end}}>
                        末页
                        <i class="fas fa-angle-double-right"></i>
                    </button>
                  </div>
            </div>
        </div>

        </div>

    <!-- Stats Modal -->
    <div class="modal" id="statsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>统计信息</h2>
                <button class="close-btn" onclick="closeModal('statsModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body" id="statsContent">
                <!-- Stats will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Help Modal -->
    <div class="modal" id="helpModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>使用帮助</h2>
                <button class="close-btn" onclick="closeModal('helpModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="help-section">
                    <h3>导航功能</h3>
                    <ul>
                        <li><strong>上一页/下一页：</strong>浏览相邻页面的词汇</li>
                        <li><strong>首页/末页：</strong>快速跳转到第一页或最后一页</li>
                        <li><strong>页码跳转：</strong>输入页码直接跳转到指定页面</li>
                    </ul>
                </div>
                <div class="help-section">
                    <h3>搜索功能</h3>
                    <ul>
                        <li><strong>关键词搜索：</strong>输入英文单词或中文翻译进行搜索</li>
                        <li><strong>实时搜索：</strong>输入时自动显示搜索结果</li>
                    </ul>
                </div>
                <div class="help-section">
                    <h3>快捷键</h3>
                    <ul>
                        <li><strong>← / →：</strong>上一页/下一页</li>
                        <li><strong>Ctrl + F：</strong>聚焦搜索框</li>
                        <li><strong>Esc：</strong>关闭弹窗或清除搜索</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- Search Modal -->
    <div class="modal" id="searchModal">
        <div class="modal-content search-modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-search"></i> 搜索词汇</h2>
                <button class="close-btn" onclick="closeSearchModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="search-input-container">
                    <input type="text" id="searchModalInput" placeholder="输入英文单词或中文翻译..." autocomplete="off">
                    <button id="searchModalBtn" class="search-btn">
                        <i class="fas fa-search"></i>
                        搜索
                    </button>
                </div>
                <div class="search-info">
                    <span id="searchResultCount">输入至少2个字符开始搜索</span>
                </div>
                <div class="search-results-container" id="searchResultsContainer" style="display: none;">
                    <div class="search-results-list" id="searchModalResults"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Word Detail Modal -->
    <div class="modal" id="wordDetailModal">
        <div class="modal-content detail-modal-content">
            <div class="modal-header">
                <h2 id="wordDetailTitle">单词详情</h2>
                <button class="close-btn" onclick="closeWordDetailModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body" id="wordDetailContent">
                <!-- Word details will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Word Action Modal -->
    <div class="modal" id="wordActionModal">
        <div class="modal-content action-modal-content">
            <div class="modal-header">
                <h2 id="wordActionTitle">单词操作</h2>
                <button class="close-btn" onclick="closeWordActionModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="action-buttons-grid">
                    <button class="action-btn large known-btn" onclick="markCurrentWordAsKnown()">
                        <i class="fas fa-check"></i>
                        <span>认识</span>
                    </button>
                    <button class="action-btn large unknown-btn" onclick="markCurrentWordAsUnknown()">
                        <i class="fas fa-times"></i>
                        <span>不认识</span>
                    </button>
                    <button class="action-btn large detail-btn" onclick="showCurrentWordDetail()">
                        <i class="fas fa-search-plus"></i>
                        <span>细品</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Reset Options Modal -->
    <div class="modal" id="resetOptionsModal">
        <div class="modal-content reset-modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-undo"></i> 重置选项</h2>
                <button class="close-btn" onclick="closeResetOptionsModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="reset-description">
                    <p>请选择重置的范围：</p>
                </div>
                <div class="reset-options-grid">
                    <div class="reset-option-card" onclick="resetCurrentPage()">
                        <div class="reset-option-icon">
                            <i class="fas fa-file-alt"></i>
                        </div>
                        <div class="reset-option-content">
                            <h3>当前页面</h3>
                            <p>清除当前页面的所有单词标记状态</p>
                            <div class="reset-option-detail">
                                <small>只影响第 <span id="currentPageNumber">1</span> 页的单词</small>
                            </div>
                        </div>
                    </div>
                    <div class="reset-option-card" onclick="resetAllPages()">
                        <div class="reset-option-icon">
                            <i class="fas fa-globe"></i>
                        </div>
                        <div class="reset-option-content">
                            <h3>全部页面</h3>
                            <p>清除所有页面的单词标记状态</p>
                            <div class="reset-option-detail">
                                <small>影响全部 <span id="totalPagesNumber">147</span> 页的 <span id="totalWordsNumber">3673</span> 个单词</small>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="reset-modal-actions">
                    <button class="action-btn secondary-btn" onclick="closeResetOptionsModal()">
                        <i class="fas fa-times"></i>
                        取消
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Statistics Modal -->
    <div class="modal" id="statisticsModal">
        <div class="modal-content statistics-modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-chart-bar"></i> 学习统计</h2>
                <button class="close-btn" onclick="closeStatisticsModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="statistics-overview">
                    <div class="stats-card">
                        <div class="stats-number" id="totalKnownWords">0</div>
                        <div class="stats-label">已认识单词</div>
                    </div>
                    <div class="stats-card">
                        <div class="stats-number" id="totalLearningDays">0</div>
                        <div class="stats-label">学习天数</div>
                    </div>
                    <div class="stats-card">
                        <div class="stats-number" id="averageWordsPerDay">0</div>
                        <div class="stats-label">日均单词</div>
                    </div>
                </div>
                <div class="chart-container">
                    <div id="dailyProgressChart" style="width: 100%; height: 400px;"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Login Modal -->
    <div class="modal" id="loginModal">
        <div class="modal-content auth-modal-content">
            <div class="modal-header">
                <h2>用户登录</h2>
                <span class="close" onclick="closeModal('loginModal')">&times;</span>
            </div>
            <div class="modal-body">
                <form id="loginForm" class="auth-form">
                    <div class="form-group">
                        <label for="loginUsername">用户名或邮箱</label>
                        <input type="text" id="loginUsername" name="username" required>
                    </div>
                    <div class="form-group">
                        <label for="loginPassword">密码</label>
                        <input type="password" id="loginPassword" name="password" required>
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">登录</button>
                        <button type="button" class="btn btn-secondary" onclick="closeModal('loginModal')">取消</button>
                    </div>
                </form>
                <div class="auth-links">
                    <p>还没有账号？<a href="#" onclick="showRegisterModal(); closeModal('loginModal')">立即注册</a></p>
                </div>
            </div>
        </div>
    </div>

    <!-- Register Modal -->
    <div class="modal" id="registerModal">
        <div class="modal-content auth-modal-content">
            <div class="modal-header">
                <h2>用户注册</h2>
                <span class="close" onclick="closeModal('registerModal')">&times;</span>
            </div>
            <div class="modal-body">
                <form id="registerForm" class="auth-form">
                    <div class="form-group">
                        <label for="registerUsername">用户名</label>
                        <input type="text" id="registerUsername" name="username" required>
                        <small>3-50个字符，只能包含字母、数字和下划线</small>
                    </div>
                    <div class="form-group">
                        <label for="registerEmail">邮箱</label>
                        <input type="email" id="registerEmail" name="email" required>
                    </div>
                    <div class="form-group">
                        <label for="registerFullName">姓名</label>
                        <input type="text" id="registerFullName" name="full_name">
                    </div>
                    <div class="form-group">
                        <label for="registerPassword">密码</label>
                        <input type="password" id="registerPassword" name="password" required>
                        <small>至少6个字符</small>
                    </div>
                    <div class="form-group">
                        <label for="registerConfirmPassword">确认密码</label>
                        <input type="password" id="registerConfirmPassword" name="confirm_password" required>
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">注册</button>
                        <button type="button" class="btn btn-secondary" onclick="closeModal('registerModal')">取消</button>
                    </div>
                </form>
                <div class="auth-links">
                    <p>已有账号？<a href="#" onclick="showLoginModal(); closeModal('registerModal')">立即登录</a></p>
                </div>
            </div>
        </div>
    </div>

    <!-- Profile Modal -->
    <div class="modal" id="profileModal">
        <div class="modal-content auth-modal-content">
            <div class="modal-header">
                <h2>个人资料</h2>
                <span class="close" onclick="closeModal('profileModal')">&times;</span>
            </div>
            <div class="modal-body">
                <form id="profileForm" class="auth-form">
                    <div class="form-group">
                        <label for="profileUsername">用户名</label>
                        <input type="text" id="profileUsername" name="username" readonly>
                    </div>
                    <div class="form-group">
                        <label for="profileEmail">邮箱</label>
                        <input type="email" id="profileEmail" name="email" readonly>
                    </div>
                    <div class="form-group">
                        <label for="profileFullName">姓名</label>
                        <input type="text" id="profileFullName" name="full_name">
                    </div>
                    <div class="form-group">
                        <label for="profileBio">个人简介</label>
                        <textarea id="profileBio" name="bio" rows="3"></textarea>
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">保存</button>
                        <button type="button" class="btn btn-secondary" onclick="closeModal('profileModal')">取消</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Change Password Modal -->
    <div class="modal" id="changePasswordModal">
        <div class="modal-content auth-modal-content">
            <div class="modal-header">
                <h2>修改密码</h2>
                <span class="close" onclick="closeModal('changePasswordModal')">&times;</span>
            </div>
            <div class="modal-body">
                <form id="changePasswordForm" class="auth-form">
                    <div class="form-group">
                        <label for="currentPassword">当前密码</label>
                        <input type="password" id="currentPassword" name="current_password" required>
                    </div>
                    <div class="form-group">
                        <label for="newPassword">新密码</label>
                        <input type="password" id="newPassword" name="new_password" required>
                        <small>至少6个字符</small>
                    </div>
                    <div class="form-group">
                        <label for="confirmNewPassword">确认新密码</label>
                        <input type="password" id="confirmNewPassword" name="confirm_new_password" required>
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">修改密码</button>
                        <button type="button" class="btn btn-secondary" onclick="closeModal('changePasswordModal')">取消</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        // Set initial page data from template
        window.initialPageData = {
            currentPage: {{.CurrentPage}},
            totalPages: {{.TotalPages}},
            totalWords: {{.TotalWords}},
            startIndex: {{.StartIndex}},
            endIndex: {{.EndIndex}},
            pageSize: {{.PageSize}}
        };
    </script>
    <script src="/static/js/app.js"></script>
</body>
</html>